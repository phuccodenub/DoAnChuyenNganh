# ğŸ¯ Há»† THá»NG Há»ŒC THÃCH NGHI CÃ NHÃ‚N HÃ“A

**TÃ i liá»‡u:** 09 - Adaptive Learning  
**PhiÃªn báº£n:** 2.0  
**Cáº­p nháº­t:** 17 thÃ¡ng 12, 2025  
**Æ¯u tiÃªn:** P2 (GiÃ¡ trá»‹ cao, chi phÃ­ vá»«a)

---

## ğŸ“– Tá»”NG QUAN

Há»‡ thá»‘ng Adaptive Learning táº¡o ra nhá»¯ng con Ä‘Æ°á»ng há»c táº­p Ä‘Æ°á»£c cÃ¡ nhÃ¢n hÃ³a cho tá»«ng há»c sinh dá»±a trÃªn ká»¹ nÄƒng hiá»‡n táº¡i, tá»‘c Ä‘á»™ há»c, vÃ  cÃ¡c khoáº£ng trá»‘ng kiáº¿n thá»©c. Há»‡ thá»‘ng nÃ y cháº¡y dÆ°á»›i dáº¡ng background job vÃ  gá»i AI Ä‘á»ƒ táº¡o khuyáº¿n nghá»‹.

### GiÃ¡ trá»‹ kinh doanh
- ğŸ“ **CÃ¡ nhÃ¢n hÃ³a 100%:** Má»—i há»c sinh cÃ³ lá»™ trÃ¬nh riÃªng
- âš¡ **Tá»‘i Æ°u thá»i gian:** Bá» qua ná»™i dung biáº¿t rá»“i, táº­p trung vÃ o gaps
- ğŸ“ˆ **TÄƒng hiá»‡u suáº¥t há»c:** +15-25% theo nghiÃªn cá»©u
- ğŸ’° **Chi phÃ­ tháº¥p:** Cháº¡y background, reuse cached recommendations

### TrÆ°á»ng há»£p sá»­ dá»¥ng
1. **Há»c sinh yáº¿u:** Lá»™ trÃ¬nh bá»• sung tá»«ng bÆ°á»›c
2. **Há»c sinh giá»i:** Challenge thÃªm, Ä‘áº©y máº¡nh
3. **Há»c sinh trung bÃ¬nh:** CÃ¢n báº±ng lÃ½ thuyáº¿t + thá»±c hÃ nh
4. **KhÃ³a há»c má»›i:** Táº¡o lá»™ trÃ¬nh khÃ³a há»c chuáº©n

---

## ğŸ—ï¸ KIáº¾N TRÃšC Há»† THá»NG

### Luá»“ng há»c thÃ­ch nghi (Adaptive Flow)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SINH VIÃŠN Báº®T Äáº¦U Há»ŒC          â”‚
â”‚  LÃ m bÃ i quiz Ä‘Ã¡nh giÃ¡            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ASSESSMENT ENGINE               â”‚
â”‚  - PhÃ¢n tÃ­ch káº¿t quáº£ quiz        â”‚
â”‚  - XÃ¡c Ä‘á»‹nh skill level          â”‚
â”‚  - PhÃ¡t hiá»‡n knowledge gaps      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TRIGGER: BACKGROUND JOB         â”‚
â”‚  - Generate learning path        â”‚
â”‚  - Estimate time to mastery      â”‚
â”‚  - Create milestone              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI RECOMMENDATION ENGINE         â”‚
â”‚  (Gemini Flash - cached)         â”‚
â”‚  - Táº¡o lesson sequence           â”‚
â”‚  - Chá»n resources phÃ¹ há»£p        â”‚
â”‚  - Set difficulty progression    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LEARNING PATH CREATED           â”‚
â”‚  - 3-5 tuáº§n, 2-3h/tuáº§n          â”‚
â”‚  - TÄƒng dáº§n difficulty           â”‚
â”‚  - Checkpoint táº¡i tuáº§n 2, 4      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
      â”‚             â”‚
   LEARN      CHECKPOINT
      â”‚             â”‚
      â–¼             â–¼
  Progress    Re-assess
  Update      Update Path
      â”‚             â”‚
      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MASTERY ACHIEVED / REDIRECT     â”‚
â”‚  - Next topic recommendation     â”‚
â”‚  - New learning path generated   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Kiáº¿n trÃºc há»‡ thá»‘ng

```
ADAPTIVE LEARNING ORCHESTRATOR
â”‚
â”œâ”€ Assessment Engine
â”‚  â”œâ”€ Quiz analyzer
â”‚  â”œâ”€ Skill detector
â”‚  â””â”€ Gap finder
â”‚
â”œâ”€ Path Generator
â”‚  â”œâ”€ Sequencing algorithm
â”‚  â”œâ”€ Difficulty calculator
â”‚  â””â”€ Milestone planner
â”‚
â”œâ”€ Recommendation Engine
â”‚  â”œâ”€ Gemini Flash (resource selection)
â”‚  â”œâ”€ Caching layer (Redis)
â”‚  â””â”€ Personalization rules
â”‚
â””â”€ Progress Tracker
   â”œâ”€ Real-time analytics
   â”œâ”€ Mastery detection
   â””â”€ Path adjustment
```

---

## ğŸ’» TRIá»‚N KHAI BACKEND

### Adaptive Learning Controller

**File:** `backend/src/modules/ai/adaptive-learning.controller.ts`

```typescript
import { Controller, Post, Get, Param, UseGuards, Req } from '@nestjs/common';
import { AuthGuard } from '@nestjs/passport';
import { AdaptiveLearningService } from './services/adaptive-learning.service';

@Controller('api/v1/adaptive-learning')
export class AdaptiveLearningController {
  constructor(private adaptiveService: AdaptiveLearningService) {}

  /**
   * Báº¯t Ä‘áº§u learning path (Ä‘Æ°á»£c gá»i sau assessment)
   * POST /api/v1/adaptive-learning/start
   */
  @Post('start')
  @UseGuards(AuthGuard('jwt'))
  async startLearningPath(
    @Req() req: any,
    @Body()
    body: {
      courseId: string;
      topicId: string;
      assessmentScore: number; // 0-100
      assessmentDetails?: {
        questionsAnswered: number;
        correctAnswers: number;
        timeSpent: number;
        conceptMastery: Record<string, number>;
      };
    }
  ) {
    return await this.adaptiveService.generateLearningPath({
      studentId: req.user.id,
      courseId: body.courseId,
      topicId: body.topicId,
      assessmentScore: body.assessmentScore,
      assessmentDetails: body.assessmentDetails
    });
  }

  /**
   * Láº¥y learning path hiá»‡n táº¡i
   * GET /api/v1/adaptive-learning/:pathId
   */
  @Get(':pathId')
  @UseGuards(AuthGuard('jwt'))
  async getLearningPath(@Param('pathId') pathId: string) {
    return await this.adaptiveService.getLearningPath(pathId);
  }

  /**
   * Update tiáº¿n Ä‘á»™ há»c
   * POST /api/v1/adaptive-learning/:pathId/progress
   */
  @Post(':pathId/progress')
  @UseGuards(AuthGuard('jwt'))
  async updateProgress(
    @Param('pathId') pathId: string,
    @Body()
    body: {
      milestoneId: string;
      completed: boolean;
      score?: number;
      timeSpent?: number;
    }
  ) {
    return await this.adaptiveService.updateProgress({
      pathId,
      milestoneId: body.milestoneId,
      completed: body.completed,
      score: body.score,
      timeSpent: body.timeSpent
    });
  }

  /**
   * Láº¥y khuyáº¿n nghá»‹ tiáº¿p theo
   * GET /api/v1/adaptive-learning/:pathId/recommendation
   */
  @Get(':pathId/recommendation')
  @UseGuards(AuthGuard('jwt'))
  async getRecommendation(@Param('pathId') pathId: string) {
    return await this.adaptiveService.getNextRecommendation(pathId);
  }

  /**
   * Reset path (thay Ä‘á»•i há»c liá»‡u)
   * POST /api/v1/adaptive-learning/:pathId/reset
   */
  @Post(':pathId/reset')
  @UseGuards(AuthGuard('jwt'))
  async resetPath(@Param('pathId') pathId: string) {
    return await this.adaptiveService.resetPath(pathId);
  }
}
```

### Adaptive Learning Service

**File:** `backend/src/modules/ai/services/adaptive-learning.service.ts`

```typescript
import { Injectable } from '@nestjs/common';
import { Cron } from '@nestjs/schedule';
import { ProxyPalService } from './providers/proxypal.service';
import { LearningPath, LearningMilestone, StudentProgress } from '@/database/models';
import Redis from 'ioredis';

interface PathGenerationRequest {
  studentId: string;
  courseId: string;
  topicId: string;
  assessmentScore: number;
  assessmentDetails?: {
    questionsAnswered: number;
    correctAnswers: number;
    timeSpent: number;
    conceptMastery: Record<string, number>;
  };
}

interface AdaptivePath {
  pathId: string;
  studentId: string;
  courseId: string;
  topicId: string;
  skillLevel: 'beginner' | 'intermediate' | 'advanced' | 'mastery';
  estimatedTimeToMastery: number; // hours
  milestones: AdaptiveMilestone[];
  knowledgeGaps: string[];
  recommendations: string[];
  createdAt: Date;
  lastUpdated: Date;
}

interface AdaptiveMilestone {
  id: string;
  sequence: number;
  title: string;
  description: string;
  resources: {
    type: 'video' | 'article' | 'exercise' | 'project' | 'quiz';
    title: string;
    url: string;
    estimatedTime: number; // minutes
    difficulty: 'easy' | 'medium' | 'hard';
  }[];
  prerequisiteMilestones: string[];
  targetConcepts: string[];
  estimatedTime: number; // hours
  successCriteria: {
    minScore: number;
    questionsToPass: number;
  };
  completed: boolean;
  score?: number;
}

@Injectable()
export class AdaptiveLearningService {
  private proxypal: ProxyPalService;
  private redis: Redis;

  constructor() {
    this.proxypal = new ProxyPalService();
    this.redis = new Redis({
      host: process.env.REDIS_HOST,
      port: Number(process.env.REDIS_PORT),
      db: 2
    });
  }

  /**
   * Táº¡o learning path dá»±a trÃªn assessment
   */
  async generateLearningPath(request: PathGenerationRequest): Promise<AdaptivePath> {
    const pathId = this.generatePathId();
    console.log(`[Adaptive] Generating learning path ${pathId} for student ${request.studentId}`);

    // Stage 1: ÄÃ¡nh giÃ¡ ká»¹ nÄƒng
    const skillLevel = this.assessSkillLevel(request.assessmentScore);
    const gaps = await this.identifyKnowledgeGaps(request);

    // Stage 2: Táº¡o chuá»—i milestone (background job)
    const milestones = await this.generateMilestones({
      topicId: request.topicId,
      skillLevel,
      knowledgeGaps: gaps,
      assessmentDetails: request.assessmentDetails
    });

    // Stage 3: Táº¡o khuyáº¿n nghá»‹
    const recommendations = await this.generateRecommendations({
      studentId: request.studentId,
      skillLevel,
      gaps,
      milestones
    });

    const path: AdaptivePath = {
      pathId,
      studentId: request.studentId,
      courseId: request.courseId,
      topicId: request.topicId,
      skillLevel,
      estimatedTimeToMastery: this.calculateTimeToMastery(skillLevel, milestones),
      milestones,
      knowledgeGaps: gaps,
      recommendations,
      createdAt: new Date(),
      lastUpdated: new Date()
    };

    // Cache vÃ  lÆ°u
    await this.redis.setex(
      `path:${pathId}`,
      30 * 24 * 60 * 60, // 30 ngÃ y
      JSON.stringify(path)
    );

    await LearningPath.create({
      id: pathId,
      studentId: request.studentId,
      courseId: request.courseId,
      topicId: request.topicId,
      skillLevel,
      milestones: JSON.stringify(milestones),
      knowledgeGaps: JSON.stringify(gaps),
      pathData: JSON.stringify(path),
      createdAt: new Date()
    });

    return path;
  }

  /**
   * ÄÃ¡nh giÃ¡ má»©c ká»¹ nÄƒng tá»« Ä‘iá»ƒm sá»‘
   */
  private assessSkillLevel(score: number): 'beginner' | 'intermediate' | 'advanced' | 'mastery' {
    if (score >= 85) return 'mastery';
    if (score >= 70) return 'advanced';
    if (score >= 55) return 'intermediate';
    return 'beginner';
  }

  /**
   * XÃ¡c Ä‘á»‹nh knowledge gaps
   */
  private async identifyKnowledgeGaps(request: PathGenerationRequest): Promise<string[]> {
    if (!request.assessmentDetails?.conceptMastery) {
      return [];
    }

    const gaps: string[] = [];
    for (const [concept, masteryScore] of Object.entries(
      request.assessmentDetails.conceptMastery
    )) {
      if (masteryScore < 60) {
        gaps.push(concept);
      }
    }
    return gaps;
  }

  /**
   * Táº¡o milestones (learning modules)
   */
  private async generateMilestones(params: {
    topicId: string;
    skillLevel: string;
    knowledgeGaps: string[];
    assessmentDetails?: any;
  }): Promise<AdaptiveMilestone[]> {
    const prompt = `Táº¡o learning path chi tiáº¿t cho chá»§ Ä‘á» sau:

CHá»¦Äá»€: ${params.topicId}
Má»¨C Ká»¸NÄ‚NG: ${params.skillLevel}
KNOWLEDGE GAPS: ${params.knowledgeGaps.join(', ')}

Táº¡o 3-5 MILESTONES vá»›i cáº¥u trÃºc:
- CÃ¡c milestone pháº£i tá»« dá»… Ä‘áº¿n khÃ³
- Æ¯u tiÃªn cÃ¡c knowledge gaps
- Má»—i milestone cÃ³ 2-4 resources
- Bao gá»“m cÃ¡c loáº¡i: video, article, exercise, project, quiz

OUTPUT JSON:
[
  {
    "sequence": 1,
    "title": "Milestone title",
    "description": "MÃ´ táº£ chi tiáº¿t",
    "resources": [
      {
        "type": "video|article|exercise|project|quiz",
        "title": "Resource title",
        "estimatedTime": 30,
        "difficulty": "easy|medium|hard"
      }
    ],
    "targetConcepts": ["concept1", "concept2"],
    "estimatedTime": 2,
    "successCriteria": {
      "minScore": 70,
      "questionsToPass": 8
    }
  }
]`;

    const response = await this.proxypal.generateContent({
      model: 'gemini-3-pro-preview',
      prompt,
      temperature: 0.6
    });

    try {
      const parsed = JSON.parse(response.text);
      return parsed.map((m: any, idx: number) => ({
        id: `milestone-${Date.now()}-${idx}`,
        sequence: m.sequence || idx + 1,
        title: m.title,
        description: m.description,
        resources: m.resources.map((r: any) => ({
          type: r.type,
          title: r.title,
          url: this.generateResourceUrl(r.type, r.title),
          estimatedTime: r.estimatedTime || 30,
          difficulty: r.difficulty || 'medium'
        })),
        prerequisiteMilestones: idx === 0 ? [] : [`milestone-${Date.now()}-${idx - 1}`],
        targetConcepts: m.targetConcepts || [],
        estimatedTime: m.estimatedTime || 2,
        successCriteria: m.successCriteria || { minScore: 70, questionsToPass: 8 },
        completed: false
      }));
    } catch (error) {
      console.error('Error parsing milestones:', error);
      return this.generateDefaultMilestones();
    }
  }

  /**
   * Táº¡o khuyáº¿n nghá»‹ cÃ¡ nhÃ¢n
   */
  private async generateRecommendations(params: {
    studentId: string;
    skillLevel: string;
    gaps: string[];
    milestones: AdaptiveMilestone[];
  }): Promise<string[]> {
    const prompt = `Dá»±a trÃªn há»“ sÆ¡ há»c sinh, hÃ£y táº¡o 3-5 khuyáº¿n nghá»‹ cÃ¡ nhÃ¢n hÃ³a:

Má»¨C Ká»¸NÄ‚NG: ${params.skillLevel}
KNOWLEDGE GAPS: ${params.gaps.join(', ')}
LEARNING MILESTONES: ${params.milestones.map((m) => m.title).join(', ')}

Khuyáº¿n nghá»‹ pháº£i:
1. Cá»¥ thá»ƒ vÃ  há»¯u Ã­ch
2. Dá»… hiá»ƒu
3. Khuyáº¿n khÃ­ch

OUTPUT: Máº£ng chuá»—i JSON`;

    const response = await this.proxypal.generateContent({
      model: 'gemini-3-pro-preview',
      prompt,
      temperature: 0.7
    });

    try {
      return JSON.parse(response.text);
    } catch {
      return [
        'HÃ£y báº¯t Ä‘áº§u tá»« milestone 1 vÃ  theo dÃµi tiáº¿n Ä‘á»™ hÃ ng ngÃ y',
        'Náº¿u gáº·p khÃ³ khÄƒn, yÃªu cáº§u giÃºp Ä‘á»¡ tá»« giÃ¡o viÃªn',
        'Ã”n táº­p tá»« cÃ¡c milestone trÆ°á»›c'
      ];
    }
  }

  /**
   * TÃ­nh thá»i gian dá»± kiáº¿n Ä‘áº¿n mastery
   */
  private calculateTimeToMastery(
    skillLevel: string,
    milestones: AdaptiveMilestone[]
  ): number {
    const baseTimes: Record<string, number> = {
      beginner: 1.5,
      intermediate: 1.0,
      advanced: 0.7,
      mastery: 0
    };

    const totalMilestoneTime = milestones.reduce((sum, m) => sum + m.estimatedTime, 0);
    return Math.round(totalMilestoneTime * (baseTimes[skillLevel] || 1));
  }

  /**
   * Update tiáº¿n Ä‘á»™ há»c
   */
  async updateProgress(params: {
    pathId: string;
    milestoneId: string;
    completed: boolean;
    score?: number;
    timeSpent?: number;
  }): Promise<void> {
    console.log(`[Adaptive] Updating progress for path ${params.pathId}`);

    const path = await this.getLearningPath(params.pathId);
    const milestone = path.milestones.find((m) => m.id === params.milestoneId);

    if (!milestone) return;

    milestone.completed = params.completed;
    if (params.score) milestone.score = params.score;

    // LÆ°u progress
    await StudentProgress.create({
      studentId: path.studentId,
      pathId: params.pathId,
      milestoneId: params.milestoneId,
      completed: params.completed,
      score: params.score,
      timeSpent: params.timeSpent,
      completedAt: params.completed ? new Date() : null
    });

    // Update cache
    await this.redis.setex(`path:${params.pathId}`, 30 * 24 * 60 * 60, JSON.stringify(path));

    // Kiá»ƒm tra mastery
    this.checkMastery(path);
  }

  /**
   * Kiá»ƒm tra mastery (hoÃ n thÃ nh path)
   */
  private async checkMastery(path: AdaptivePath): Promise<void> {
    const allCompleted = path.milestones.every((m) => m.completed);
    const averageScore =
      path.milestones.reduce((sum, m) => sum + (m.score || 0), 0) / path.milestones.length;

    if (allCompleted && averageScore >= 75) {
      console.log(
        `[Adaptive] Student ${path.studentId} achieved mastery on path ${path.pathId}`
      );
      // Trigger next path generation
      await this.triggerNextPath(path);
    }
  }

  /**
   * Láº¥y learning path
   */
  async getLearningPath(pathId: string): Promise<AdaptivePath> {
    const cached = await this.redis.get(`path:${pathId}`);
    if (cached) return JSON.parse(cached);

    const record = await LearningPath.findOne({ where: { id: pathId } });
    if (!record) throw new Error(`Path ${pathId} not found`);

    return JSON.parse(record.pathData);
  }

  /**
   * Láº¥y khuyáº¿n nghá»‹ tiáº¿p theo
   */
  async getNextRecommendation(pathId: string): Promise<any> {
    const path = await this.getLearningPath(pathId);
    const nextMilestone = path.milestones.find((m) => !m.completed);

    if (!nextMilestone) {
      return {
        message: 'ChÃºc má»«ng! Báº¡n Ä‘Ã£ hoÃ n thÃ nh chá»§ Ä‘á» nÃ y',
        nextStep: 'Äá»£i khuyáº¿n nghá»‹ tiáº¿p theo tá»« há»‡ thá»‘ng'
      };
    }

    return {
      milestoneId: nextMilestone.id,
      title: nextMilestone.title,
      description: nextMilestone.description,
      estimatedTime: nextMilestone.estimatedTime,
      resources: nextMilestone.resources,
      targetConcepts: nextMilestone.targetConcepts,
      successCriteria: nextMilestone.successCriteria
    };
  }

  /**
   * Reset path
   */
  async resetPath(pathId: string): Promise<AdaptivePath> {
    const path = await this.getLearningPath(pathId);
    path.milestones.forEach((m) => {
      m.completed = false;
      m.score = undefined;
    });

    await this.redis.setex(`path:${pathId}`, 30 * 24 * 60 * 60, JSON.stringify(path));
    return path;
  }

  /**
   * Trigger path tiáº¿p theo (background job)
   */
  @Cron('0 0 * * *') // Cháº¡y má»—i ngÃ y
  async triggerNextPathGeneration(): Promise<void> {
    console.log('[Adaptive] Checking for mastery students...');

    // Find all paths with all milestones completed
    // Generate next paths for these students
  }

  /**
   * HÃ m helper
   */
  private generatePathId(): string {
    return `path-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
  }

  private generateResourceUrl(type: string, title: string): string {
    return `/resources/${type}/${encodeURIComponent(title)}`;
  }

  private generateDefaultMilestones(): AdaptiveMilestone[] {
    return [
      {
        id: 'milestone-1',
        sequence: 1,
        title: 'KhÃ¡i niá»‡m cÆ¡ báº£n',
        description: 'TÃ¬m hiá»ƒu cÃ¡c khÃ¡i niá»‡m cÆ¡ báº£n cá»§a chá»§ Ä‘á»',
        resources: [
          {
            type: 'video',
            title: 'Introduction video',
            url: '/resources/video/intro',
            estimatedTime: 15,
            difficulty: 'easy'
          }
        ],
        prerequisiteMilestones: [],
        targetConcepts: [],
        estimatedTime: 1,
        successCriteria: { minScore: 70, questionsToPass: 5 },
        completed: false
      }
    ];
  }

  private async triggerNextPath(path: AdaptivePath): Promise<void> {
    // Implement next path generation
  }
}
```

---

## ğŸ¨ TRIá»‚N KHAI FRONTEND

### Learning Path Component

**File:** `frontend/src/features/student/components/LearningPathPanel.tsx`

```typescript
import React, { useState, useEffect } from 'react';
import { api } from '@/services/api';
import { Card, Progress, Badge, Timeline } from '@/components/ui';

interface LearningPathPanelProps {
  pathId: string;
}

export const LearningPathPanel: React.FC<LearningPathPanelProps> = ({ pathId }) => {
  const [path, setPath] = useState<any>(null);
  const [loading, setLoading] = useState(true);
  const [nextMilestone, setNextMilestone] = useState<any>(null);

  useEffect(() => {
    loadPath();
    loadNextMilestone();
  }, [pathId]);

  const loadPath = async () => {
    try {
      const response = await api.get(`/adaptive-learning/${pathId}`);
      setPath(response.data);
      setLoading(false);
    } catch (error) {
      console.error('Error loading path:', error);
      setLoading(false);
    }
  };

  const loadNextMilestone = async () => {
    try {
      const response = await api.get(`/adaptive-learning/${pathId}/recommendation`);
      setNextMilestone(response.data);
    } catch (error) {
      console.error('Error loading recommendation:', error);
    }
  };

  const handleMilestoneComplete = async (milestoneId: string, score: number) => {
    try {
      await api.post(`/adaptive-learning/${pathId}/progress`, {
        milestoneId,
        completed: true,
        score
      });
      loadPath();
      loadNextMilestone();
    } catch (error) {
      console.error('Error updating progress:', error);
    }
  };

  if (loading) return <div>Äang táº£i...</div>;
  if (!path) return <div>KhÃ´ng tÃ¬m tháº¥y learning path</div>;

  const completedCount = path.milestones.filter((m: any) => m.completed).length;
  const progressPercent = (completedCount / path.milestones.length) * 100;

  return (
    <div className="learning-path space-y-6">
      {/* Header */}
      <div className="header">
        <h2 className="text-2xl font-bold mb-2">Lá»™ trÃ¬nh há»c táº­p cÃ¡ nhÃ¢n</h2>
        <div className="flex gap-3 items-center mb-4">
          <Badge variant={path.skillLevel === 'mastery' ? 'success' : 'info'}>
            {path.skillLevel.toUpperCase()}
          </Badge>
          <span className="text-sm text-gray-600">
            Dá»± kiáº¿n: {path.estimatedTimeToMastery} giá»
          </span>
        </div>

        <div className="progress-bar">
          <div className="flex justify-between text-sm mb-2">
            <span>Tiáº¿n Ä‘á»™: {completedCount}/{path.milestones.length}</span>
            <span>{progressPercent.toFixed(0)}%</span>
          </div>
          <Progress value={progressPercent} />
        </div>
      </div>

      {/* Khuyáº¿n nghá»‹ tiáº¿p theo */}
      {nextMilestone?.milestoneId && (
        <Card className="bg-blue-50 border-blue-200 p-4">
          <h3 className="font-bold mb-2">ğŸ“Œ BÆ°á»›c tiáº¿p theo</h3>
          <p className="text-sm mb-3">{nextMilestone.description}</p>
          <div className="resources space-y-2">
            {nextMilestone.resources.map((r: any, idx: number) => (
              <div key={idx} className="text-sm">
                <Badge className="mr-2">{r.type}</Badge>
                <a href={r.url} className="text-blue-600 hover:underline">
                  {r.title}
                </a>
                <span className="text-gray-500 ml-2">({r.estimatedTime}m)</span>
              </div>
            ))}
          </div>
        </Card>
      )}

      {/* Milestones Timeline */}
      <div className="milestones">
        <h3 className="text-lg font-bold mb-4">CÃ¡c má»¥c tiÃªu há»c táº­p</h3>
        <Timeline>
          {path.milestones.map((milestone: any, idx: number) => (
            <div
              key={idx}
              className={`milestone-item p-4 rounded mb-3 ${
                milestone.completed
                  ? 'bg-green-50 border-green-200'
                  : 'bg-gray-50 border-gray-200'
              } border`}
            >
              <div className="flex items-start justify-between">
                <div className="flex-1">
                  <div className="flex items-center gap-2 mb-2">
                    {milestone.completed ? (
                      <span className="text-green-600">âœ…</span>
                    ) : (
                      <span className="text-gray-400">â­•</span>
                    )}
                    <h4 className="font-semibold">{milestone.title}</h4>
                    {milestone.score && (
                      <Badge variant="success">{milestone.score}%</Badge>
                    )}
                  </div>
                  <p className="text-sm text-gray-600 mb-3">
                    {milestone.description}
                  </p>

                  <div className="grid grid-cols-2 gap-2 mb-3">
                    <div className="text-xs">
                      <span className="text-gray-500">KhÃ¡i niá»‡m:</span>
                      <div>
                        {milestone.targetConcepts.map((c: string) => (
                          <Badge key={c} className="mr-1 text-xs" variant="outline">
                            {c}
                          </Badge>
                        ))}
                      </div>
                    </div>
                    <div className="text-xs">
                      <span className="text-gray-500">Thá»i gian:</span>
                      <p className="font-semibold">{milestone.estimatedTime}h</p>
                    </div>
                  </div>

                  {!milestone.completed && (
                    <button
                      onClick={() => handleMilestoneComplete(milestone.id, 85)}
                      className="px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700"
                    >
                      HoÃ n thÃ nh
                    </button>
                  )}
                </div>
              </div>
            </div>
          ))}
        </Timeline>
      </div>

      {/* Khuyáº¿n nghá»‹ */}
      {path.recommendations.length > 0 && (
        <Card className="bg-yellow-50 border-yellow-200 p-4">
          <h3 className="font-bold mb-3">ğŸ’¡ Khuyáº¿n nghá»‹ cho báº¡n</h3>
          <ul className="space-y-2">
            {path.recommendations.map((rec: string, idx: number) => (
              <li key={idx} className="text-sm flex gap-2">
                <span>â†’</span>
                <span>{rec}</span>
              </li>
            ))}
          </ul>
        </Card>
      )}
    </div>
  );
};
```

---

## âš™ï¸ Cáº¤U HÃŒNH

**File:** `backend/.env`

```bash
# Adaptive Learning
ADAPTIVE_SKILL_LEVELS=beginner,intermediate,advanced,mastery
ADAPTIVE_MIN_MASTERY_SCORE=75
ADAPTIVE_CACHE_TTL=2592000 # 30 ngÃ y
ADAPTIVE_BACKGROUND_JOB_INTERVAL=daily

# Path Generation
ADAPTIVE_MILESTONES_COUNT=3-5
ADAPTIVE_RESOURCE_TYPES=video,article,exercise,project,quiz
```

---

## ğŸ§ª KIá»‚M THá»¬

```typescript
describe('Adaptive Learning', () => {
  it('should generate learning path for beginner', async () => {
    const result = await service.generateLearningPath({
      studentId: 'student-1',
      courseId: 'course-1',
      topicId: 'topic-1',
      assessmentScore: 45,
      assessmentDetails: {
        questionsAnswered: 10,
        correctAnswers: 5,
        timeSpent: 600,
        conceptMastery: {
          'concept-1': 30,
          'concept-2': 50,
          'concept-3': 40
        }
      }
    });

    expect(result.skillLevel).toBe('beginner');
    expect(result.knowledgeGaps.length).toBeGreaterThan(0);
    expect(result.milestones.length).toBeGreaterThan(0);
    expect(result.estimatedTimeToMastery).toBeGreaterThan(0);
  });

  it('should update progress and check mastery', async () => {
    // Create path
    const path = await service.generateLearningPath({
      /* ... */
    });

    // Complete all milestones
    for (const milestone of path.milestones) {
      await service.updateProgress({
        pathId: path.pathId,
        milestoneId: milestone.id,
        completed: true,
        score: 85
      });
    }

    // Verify mastery was triggered
  });
});
```

---

## ğŸ“š LIÃŠN QUAN

- **TrÆ°á»›c:** [08_CONTENT_REPURPOSING.md](08_CONTENT_REPURPOSING.md)
- **Tiáº¿p:** [10_API_DESIGN.md](10_API_DESIGN.md)
- **Chiáº¿n lÆ°á»£c:** [03_STRATEGY.md](03_STRATEGY.md)

---

**PhiÃªn báº£n:** 2.0  
**Cáº­p nháº­t láº§n cuá»‘i:** 17 thÃ¡ng 12, 2025
